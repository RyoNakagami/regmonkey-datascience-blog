---
title: "Sony WH-1000XM4ã‚’Ubuntu 24.04 LTSã§ä½¿ã†"
author: "Ryo Nakagami"
date: "2025-09-18"
date-modified: "2025-12-28"
categories: [bluetooth]
listing_category: general
comments:
  utterances:
       repo: RyoNakagami/regmonkey-datascience-blog
       label: discussion
       issue-term: title
execute:
  echo: true
---

## ğŸ¯ Goals

- Ubuntu 24.04 LTSã«å¯¾ã™ã‚‹LDACåˆ©ç”¨å¯èƒ½ãªçŠ¶æ…‹ã§ã®WH-1000XM4æ¥ç¶šè¨­å®š
- EasyEffectsã‚’ç”¨ã„ãŸWH-1000XM4ç”¨Equalizerã®è¨­å®š

[Package Requirements]{.mini-section}

| ã‚«ãƒ†ã‚´ãƒª               | ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸                             | èª¬æ˜                                         |
| ------------------ | --------------------------------- | ------------------------------------------ |
| **Bluetooth LDAC** | `libldacbt-abr-dev`               | LDAC ã® ABR (Adaptive Bitrate) ãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼ˆé–‹ç™ºç”¨ï¼‰   |
|                    | `libldacbt-enc-dev`               | LDAC ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼ˆé–‹ç™ºç”¨ï¼‰                       |
| **Bluetooth ç®¡ç†**  | `blueman`                         | Bluetooth ãƒ‡ãƒã‚¤ã‚¹ç®¡ç†ç”¨ GUI                      |
| **ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªåŸºç›¤**    | `pipewire`                        | ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªã‚µãƒ¼ãƒï¼ˆPulseAudio äº’æ›ï¼‰                 |
|                    | `pipewire-pulse`                  | PulseAudio ã‚¢ãƒ—ãƒªäº’æ›ã‚µãƒ¼ãƒ                        |
|                    | `wireplumber`                     | PipeWire ã®session / policy manager                  |
| **éŸ³è³ªè£œæ­£**        | `easyeffects`                     | éŸ³éŸ¿è£œæ­£ãƒ„ãƒ¼ãƒ«(Equalizerãªã©)                    |
: {tbl-colwidths="[25,25,50]"}

ä»Šå›ã¯Pipewireç’°å¢ƒã§ã®æ¥ç¶šè¨­å®šã¨ãªã‚Šã¾ã™ï¼

## ğŸ’» å®Ÿè¡Œç’°å¢ƒ

### Ubuntu

[Distribution]{.mini-section}

```bash
% lsb_release -a
No LSB modules are available.
Distributor ID:	Ubuntu
Description:	Ubuntu 24.04.3 LTS
Release:	24.04
Codename:	noble
```

[Linux kernel]{.mini-section}

```bash
% uname -srpo
Linux 6.14.0-29-generic x86_64 GNU/Linux
```

### ğŸ§ Sony WH-1000XM4ã®ã‚¹ãƒšãƒƒã‚¯

[ãƒ¯ã‚¤ãƒ¤ãƒ¬ã‚¹æ©Ÿèƒ½]{.mini-section}

| é …ç›®             | å†…å®¹                               |
| -------------- | -------------------------------- |
| Bluetoothãƒãƒ¼ã‚¸ãƒ§ãƒ³ | Ver.5.0 / Class 1                |
| é€£ç¶šå†ç”Ÿæ™‚é–“         | æœ€å¤§30æ™‚é–“ï¼ˆNC ONæ™‚ï¼‰ / æœ€å¤§38æ™‚é–“ï¼ˆNC OFFæ™‚ï¼‰ |
| å……é›»æ™‚é–“           | ç´„3æ™‚é–“                             |
| å¯¾å¿œã‚³ãƒ¼ãƒ‡ãƒƒã‚¯        | SBC / AAC / LDAC                 |
| NFC            | â—‹                                |
| TWS Pluså¯¾å¿œ     | â˜“                                |
| ãƒãƒ«ãƒãƒšã‚¢ãƒªãƒ³ã‚°å¯¾å¿œ     | â—‹                                |
| ãƒãƒ«ãƒãƒã‚¤ãƒ³ãƒˆå¯¾å¿œ      | â—‹                                |

[æ©Ÿèƒ½]{.mini-section}

| é …ç›®             | å†…å®¹                               |
| --------------- | -------------------------------- |
| é‡é‡             | 254g                              |
| ãƒã‚¤ã‚ºã‚­ãƒ£ãƒ³ã‚»ãƒªãƒ³ã‚°     | â—‹                                |
| ãƒã‚¤ãƒ¬ã‚¾           | â—‹                                |
| ãƒã‚¤ã‚¯            | â—‹                                |
| å¤–éŸ³å–ã‚Šè¾¼ã¿         | â—‹                                |
| éŸ³è³ªèª¿æ•´           | â—‹                                |
| é˜²æ°´ãƒ»é˜²å¡µæ€§èƒ½        | â˜“                                |
| ãƒªãƒ¢ã‚³ãƒ³æ“ä½œ           | â—‹                                |
| æŠ˜ã‚ŠãŸãŸã¿          | â—‹                                |
| ã‚µãƒ©ã‚¦ãƒ³ãƒ‰          | â˜“                                |
| AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆæ­è¼‰     | Google ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ / Amazon Alexa     |
| AIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆå‘¼ã³å‡ºã—æ©Ÿèƒ½ | â—‹                                |

::: {.callout-caution}
### ãƒãƒ«ãƒãƒã‚¤ãƒ³ãƒˆæ¥ç¶šã®æ³¨æ„ç‚¹

- WH-1000XM4ã§ã¯ãƒãƒ«ãƒãƒã‚¤ãƒ³ãƒˆæ¥ç¶šè¨­å®šOnã«ã™ã‚‹ã¨LDACãŒä½¿ç”¨ã§ããªããªã‚Šã¾ã™
- WH-1000XM5ä»¥é™ã§ã¯ã“ã®ç‚¹ã¯æ”¹å–„ã•ã‚Œã¦ã„ã¾ã™

:::

[LDACã¨ã¯ï¼Ÿ]{.mini-section}

LDACã¨ã¯Sony ãŒé–‹ç™ºã—ãŸ Bluetoothã‚ªãƒ¼ãƒ‡ã‚£ã‚ªã‚³ãƒ¼ãƒ‡ãƒƒã‚¯ã§ã™ï¼Bluetoothã®ã‚³ãƒ¼ãƒ‡ãƒƒã‚¯ã¨ã¯ï¼Œã‚¹ãƒãƒ›ã‚„éŸ³æ¥½å†ç”Ÿãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãªã©ã®ãƒ‡ãƒã‚¤ã‚¹ã‹ã‚‰ãƒ¯ã‚¤ãƒ¤ãƒ¬ã‚¹ã‚¤ãƒ¤ãƒ›ãƒ³ã‚„ãƒ˜ãƒƒãƒ‰ãƒ›ãƒ³ãªã©ã«ç„¡ç·šã§éŸ³æ¥½ã®ãƒ‡ãƒ¼ã‚¿ã‚’é€ã‚‹éš›ã®ç¬¦å·åŒ–ã®è¦æ ¼ã§ã™ï¼
åœ§ç¸®ã®è¦æ ¼ã§ã‚‚ã‚ã‚‹ã®ã§å…ƒã®éŸ³æ¥½ãƒ‡ãƒ¼ã‚¿ã‚’åœ§ç¸®ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã—Bluetoothã§é£›ã°ã—ï¼Œå—ä¿¡ãƒ‡ãƒã‚¤ã‚¹ã®ã‚¤ãƒ¤ãƒ›ãƒ³ãªã©ã§ãƒ‡ã‚³ãƒ¼ãƒ‰ã™ã‚‹ã“ã¨ã§éŸ³æ¥½ã®å†ç”Ÿã‚’ã—ã¦ã„ã¾ã™ï¼ãã®ãŸã‚ï¼Œã‚³ãƒ¼ãƒ‡ãƒƒã‚¯ã®é•ã„ã«ã‚ˆã‚Šï¼ŒéŸ³è³ªã‚„é…å»¶ã«é•ã„ãŒå‡ºã¾ã™ï¼

| ç‰¹æ€§é …ç›®      | å†…å®¹                                                   |
| --------- | ---------------------------------------------------- |
| ã‚³ãƒ¼ãƒ‡ãƒƒã‚¯å    | **LDAC**                                             |
| ç‰¹å¾´        | ãƒã‚¤ãƒ¬ã‚¾å¯¾å¿œã®æœ€é«˜éŸ³è³ª Bluetooth ã‚³ãƒ¼ãƒ‡ãƒƒã‚¯ï¼ˆSony é–‹ç™ºï¼‰                 |
| ä¸»ãªæ¡ç”¨æ©Ÿå™¨    | ãƒã‚¤ãƒ¬ã‚¾å¯¾å¿œ Android / iOS / Windows / Mac / Linux (PipeWire)    |
| ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°å‘¨æ³¢æ•° | æœ€å¤§ **96 kHz**                                        |
| é‡å­åŒ–ãƒ“ãƒƒãƒˆæ•°   | æœ€å¤§ **24 bit**                                        |
| ãƒ“ãƒƒãƒˆãƒ¬ãƒ¼ãƒˆãƒ¢ãƒ¼ãƒ‰ | **330 kbps / 660 kbps / 990 kbps** ã® 3 æ®µéšï¼ˆABRã§è‡ªå‹•èª¿æ•´å¯ï¼‰ |
| é…å»¶        | SBC / AAC ã‚ˆã‚Šå¤§ãã‚ï¼ˆé«˜éŸ³è³ªå„ªå…ˆã®ãŸã‚ï¼‰                            |


## ğŸ”¨ WH-1000XM4æ¥ç¶šè¨­å®š

```{mermaid}
---
config:
  theme: redux
  themeVariables:
    fontFamily: '"Meiryo"'
    fontSize: 1.1em
    lineHeight: 1.4
---
timeline
    title WH-1000XM4æ¥ç¶šè¨­å®šæ‰‹é †
    section â‘  Bluetooth æ¥ç¶šç¢ºèª
        Bluetooth Manager<br>ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
            : Blueman<br>ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
        LDAC ã‚µãƒãƒ¼ãƒˆç¢ºèª
            : LDAC encoding toolã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
            : Adaptive bit rate tooã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
    section â‘¡ Configèª¿æ•´
        Pipewireè¨­å®š
            : sampling frequencyã®è¨­å®š
        Wireplumberè¨­å®š
            : LDAC encoding qualityã®è¨­å®š
    section â‘¢ WH-1000MX4å‹•ä½œç¢ºèª
        Bluetooth ãƒšã‚¢ãƒªãƒ³ã‚° : Bluemanã§ WH-1000XM4 ã‚’æ¥ç¶š
        æ¥ç¶šç¢ºèª
            : å‘¨æ³¢æ•°ç¢ºèª
            : Codecç¢ºèª
            : LDAC bit rateç¢ºèª

```

[Bluetooth Managerã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«]{.mini-section}

ã¾ãšBluetooth ãƒ‡ãƒã‚¤ã‚¹ç®¡ç†ãƒ„ãƒ¼ãƒ« Blueman ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ï¼
Ubuntu 24.04 LTSã«ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§Bluetooth ManagerãŒå…¥ã£ã¦ã„ã‚‹ã®ã§ã€Œæ¥ç¶šã—ã¦éŸ³ã‚’å‡ºã™ã€ã ã‘ãªã‚‰ã°ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ä¸è¦ã§ã™ï¼

ä¸€æ–¹ï¼Œæ¥ç¶šãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚„codecã®é¸æŠã¨ã„ã£ãŸåˆ¶å¾¡ãŒã—ã‚„ã™ã„ã®ã§ä»Šå›å°å…¥ã—ã¾ã™ï¼

```{bash}
sudo apt install blueman
```


[LDAC codecã®è¨­å®š]{.mini-section}

Ubuntu 24.04 ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã® Bluetooth Managerã ã¨LDACã¯ä½¿ç”¨ã§ããªã„ã®ã§ï¼Œä»¥ä¸‹ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™

- `libldacbt-enc-dev`: LDACã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°å‡¦ç†ç”¨ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸
- `libldacbt-abr-dev`: Adaptive Bit Rateã«å¯¾å¿œã™ã‚‹ãŸã‚ã®é–‹ç™ºãƒ©ã‚¤ãƒ–ãƒ©ãƒª

`-dev` suffixãŒç„¡ã„ã‚‚ã®ã§ã‚‚è‰¯ã„ã‚ˆã†ãªæ°—ãŒã—ã¾ã™ãŒï¼Œä»Šå¾Œãƒ“ãƒ«ãƒ‰ã¨ã‹ã™ã‚‹ã‹ã‚‚ãªã®ã§å¤§ã¯å°ã‚’å…¼ã­ã‚‹ã¨ã—ã¦é–‹ç™ºç”¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼
ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚³ãƒãƒ³ãƒ‰ã¯ä»¥ä¸‹

```bash
sudo apt install libldacbt-abr-dev libldacbt-enc-dev
```

[Bluetoothæ¥ç¶šç¢ºèª]{.mini-section}

Bluetooth Managerã‚’èµ·å‹•ã—ã¦ï¼ŒWH-1000XM4ã‚’ãƒšã‚¢ãƒªãƒ³ã‚°æ¥ç¶šã—ã¾ã™ï¼ã“ã®ã¨ãï¼ŒLDAC codecã‚’æŒ‡å®šã™ã‚‹ã®ã‚’å¿˜ã‚Œãšã«

![BluetoothåˆæœŸæ¥ç¶š](./connection.png)

æ¬¡ã« `pactl list sinks` ã‚³ãƒãƒ³ãƒ‰ã‚’ç”¨ã„ã¦æ¥ç¶šçŠ¶æ…‹ã‚’ç¢ºèªã—ã¦ã¿ã¾ã™ï¼

:::: {.no-border-top-table}

| æ§‹æˆè¦ç´               | èª¬æ˜                                                 |
| ----------------- | -------------------------------------------------- |
| **pactl**         | PulseAudio ã®åˆ¶å¾¡ãƒ„ãƒ¼ãƒ«ï¼ã‚µã‚¦ãƒ³ãƒ‰ãƒ‡ãƒã‚¤ã‚¹ã®çŠ¶æ…‹å–å¾—ã‚„æ“ä½œã®ã‚³ãƒãƒ³ãƒ‰ï¼             |
| **list sinks**    | å‡ºåŠ›ãƒ‡ãƒã‚¤ã‚¹ï¼ˆ`sink`ï¼ã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼ã‚„Bluetoothã‚¤ãƒ¤ãƒ›ãƒ³ãªã©ï¼‰ã®ä¸€è¦§ã‚’è¡¨ç¤ºã™ã‚‹ã‚µãƒ–ã‚³ãƒãƒ³ãƒ‰  |

::::

Bluetoothãƒ‡ãƒã‚¤ã‚¹ã¯ `Name: bluez` ã¨ã„ã†sinkåã«ãªã‚Šã¾ã™ï¼ã“ã‚Œã‚‰ã‚’è¸ã¾ãˆã¦çŠ¶æ…‹ã‚’ç¢ºèªã—ã¦ã¿ã¾ã™

```zsh
% pactl list sinks | grep -A 20 'Name: bluez'
	Name: bluez_output.xx_xx_xx_xx_xx_xx.1
	Description: WH-1000XM4
	Driver: PipeWire
	Sample Specification: float32le 2ch 48000Hz
	Channel Map: front-left,front-right
	Owner Module: 4294967295
	Mute: no
	Volume: front-left: 28382 /  43% / -21.81 dB,   front-right: 28382 /  43% / -21.81 dB
	        balance 0.00
	Base Volume: 65536 / 100% / 0.00 dB
	Monitor Source: bluez_output.xx_xx_xx_xx_xx_xx.1.monitor
	Latency: 0 usec, configured 0 usec
	Flags: HARDWARE HW_VOLUME_CTRL DECIBEL_VOLUME LATENCY 
	Properties:
		api.bluez5.address = "xx:xx:xx:xx:xx:xx"
		api.bluez5.codec = "ldac"
		api.bluez5.profile = "a2dp-sink"
		api.bluez5.transport = ""
		card.profile.device = "1"
		device.id = "179"
		device.routes = "1"
```

ã“ã“ã‹ã‚‰ï¼ŒBluetooth ã‚³ãƒ¼ãƒ‡ãƒƒã‚¯ã¨ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ãƒ¬ãƒ¼ãƒˆã®ç¢ºèªãŒã§ãã¾ã™ï¼

ä»¥ä¸‹ã®ã‚ˆã†ã«codecã¯å•é¡ŒãªãLDACã®èªè­˜ã¨ãªã£ã¦ã¾ã™

```ini
  api.bluez5.codec = "ldac"
  api.bluez5.profile = "a2dp-sink"
```

ä¸€æ–¹ï¼Œsamplking frequencyãŒ

```ini
	Sample Specification: float32le 2ch 48000Hz
```

ã¨ãªã£ã¦ã„ã¾ã™ï¼LDACã¯æœ€å¤§96kHzå¯¾å¿œã§ãã‚‹ã¯ãšãªã®ã§ï¼ŒPipeWire ã®ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°å‘¨æ³¢æ•°ã‚’è¨­å®šã—ã¾ã™ï¼


[sampling frequencyã®è¨­å®š]{.mini-section}

`/usr/share/pipewire/pipewire.conf` ã«è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚‹ã®ã§ã“ã‚Œã‚’ä¿®æ­£ã—ã¾ã™ï¼

- `default.clock.rate`: ãƒ•ã‚©ãƒ«ãƒˆã®ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°å‘¨æ³¢æ•°(Hz)
- `default.clock.allowed-rates`: PipeWire ãŒåˆ‡ã‚Šæ›¿ãˆã‚’è¨±å¯ã™ã‚‹ã‚µãƒ³ãƒ—ãƒ«ãƒ¬ãƒ¼ãƒˆã®ãƒªã‚¹ãƒˆ

ä»¥ä¸Š2ã¤ã®é …ç›®ã‚’ä¿®æ­£ã—ã¾ã™ï¼

```ini
default.clock.rate          = 96000
default.clock.allowed-rates = [ 48000, 96000 ]
```

ã¨ã„ã†å½¢ã«å¤‰æ›´ã—ã¾ã™ï¼`/usr/share/pipewire/pipewire.conf` ã¯ `root` ownerã®ãƒ•ã‚¡ã‚¤ãƒ«ãªã®ã§ï¼Œä¿®æ­£ã™ã‚‹ã¨ãã¯

```bash
sudo vim /usr/share/pipewire/pipewire.conf
```

ã§ç·¨é›†ã—ã¾ã™ï¼


```ini
...
context.properties = {
    ## Configure properties in the system.
    #library.name.system                   = support/libspa-support
    #context.data-loop.library.name.system = support/libspa-support
    #support.dbus                          = true
    #link.max-buffers                      = 64
    link.max-buffers                       = 16                       # version < 3 clients can't handle more
    #mem.warn-mlock                        = false
    #mem.allow-mlock                       = true
    #mem.mlock-all                         = false
    #clock.power-of-two-quantum            = true
    #log.level                             = 2
    #cpu.zero.denormals                    = false

    core.daemon = true              # listening for socket connections
    core.name   = pipewire-0        # core name and socket name

    ## Properties for the DSP configuration.
    default.clock.rate          = 96000
    default.clock.allowed-rates = [ 48000, 96000 ]
    default.clock.quantum       = 1024
    default.clock.min-quantum   = 32
    default.clock.max-quantum   = 2048
    default.clock.quantum-limit = 8192
    default.clock.quantum-floor = 4
    #default.video.width         = 640
    #default.video.height        = 480
    #default.video.rate.num      = 25
    #default.video.rate.denom    = 1
    #
    #settings.check-quantum      = false
    #settings.check-rate         = false
    #
    # These overrides are only applied when running in a vm.
    vm.overrides = {
        default.clock.min-quantum = 1024
    }
...
```

ç·¨é›†å¾Œã«ã‚µãƒ¼ãƒ“ã‚¹ã‚’å†èµ·å‹•ã—ã¦è¨­å®šã‚’èª­ã¿è¾¼ã¾ã›ã¾ã™ï¼

```bash
systemctl --user restart pipewire pipewire-pulse wireplumber
```

ã‚‚ã—æ¥ç¶šãŒå®‰å®šã—ã¦ã„ã‚Œã°sampling frequencyã‚’ç¢ºèªã™ã‚‹ã¨96kHzã«ãªã£ã¦ã„ã‚‹ã¯ãšã§ã™

```zsh
% pactl list sinks | grep -A 20 'Name: bluez'|grep "Sample Specification:"
	Sample Specification: float32le 2ch 96000Hz
```

ãŸã ã—ï¼Œã‹ãªã‚‰ãš96kHzã¨ã¯ãªã‚Šã¾ã›ã‚“ï¼ã‚ãã¾ã§æœ€å¤§96kHzã§ã‚ã£ã¦ï¼Œæ¥ç¶šçŠ¶æ…‹ã«å¿œã˜ã¦ 48kHz ã«ãªã£ãŸã‚Šã¾ã™ï¼

[LDAC encoding qualityã®è¨­å®š]{.mini-section}

Bit rateã¯ï¼Œå‹•ç”»ã®1ç§’ã‚ãŸã‚Šã®ãƒ‡ãƒ¼ã‚¿é‡ã‚’ç¤ºã™å€¤ã§ã™ï¼ bpsï¼ˆbits per secondï¼‰ã¨è¡¨è¨˜ã•ã‚Œï¼Œ1Mbpsã«è¨­å®šã•ã‚Œã¦ã„ã‚‹å ´åˆï¼Œ1ç§’ã‚ãŸã‚Šãƒ‡ãƒ¼ã‚¿é‡ãŒ0.125MBï¼ˆ1byteï¼8bitï¼‰ã®å‹•ç”»ã¨ã„ã†ã“ã¨ã«ãªã‚Šã¾ã™ï¼ 
ãƒ“ãƒƒãƒˆãƒ¬ãƒ¼ãƒˆãŒé«˜ã„å‹•ç”»ã»ã©ï¼Œãƒ‡ãƒ¼ã‚¿é‡ãŒå¤šãé«˜ç”»è³ªã§ã™ï¼

LDACã®bit rateã‚’é«˜å“è³ªãƒ¢ãƒ¼ãƒ‰ã§å®‰å®šã•ã›ãŸã„å ´åˆã¯ï¼ŒWirePlumber ã® Bluetooth è¨­å®šãƒ•ã‚¡ã‚¤ãƒ« `/usr/share/wireplumber/bluetooth.lua.d/50-bluez-config.lua` ã‚’ç·¨é›†ã—ã¾ã™ï¼
`bluez5.a2dp.ldac.quality` ã¨ã„ã†ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒLDAC ã®ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰å“è³ªã‚’è¨­å®šã™ã‚‹ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ã™ï¼

:::: {.no-border-top-table}

| å€¤      | èª¬æ˜                                  | ãƒ“ãƒƒãƒˆãƒ¬ãƒ¼ãƒˆ         |
| ------ | ----------------------------------- | -------------- |
| `auto` | é©å¿œãƒ“ãƒƒãƒˆãƒ¬ãƒ¼ãƒˆï¼ˆAdaptive Bitrateï¼‰ï¼Œãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ | å¤‰å‹•             |
| `hq`   | é«˜å“è³ªãƒ¢ãƒ¼ãƒ‰                              | 990 / 909 kbps |
| `sq`   | æ¨™æº–å“è³ªãƒ¢ãƒ¼ãƒ‰                             | 660 / 606 kbps |
| `mq`   | ãƒ¢ãƒã‚¤ãƒ«ç”¨ä½ãƒ“ãƒƒãƒˆãƒ¬ãƒ¼ãƒˆãƒ¢ãƒ¼ãƒ‰                     | 330 / 303 kbps |

::::

`hq` ã‚’è¨­å®šã™ã‚Œã°ï¼Œç†è«–ä¸Šã¯æœ€å¤§ 96 kHz ã®ã‚µãƒ³ãƒ—ãƒ«ãƒ¬ãƒ¼ãƒˆã‚’ãƒ•ãƒ«å“è³ªã§åˆ©ç”¨ã§ãã‚‹ã¯ãšã§ã™ï¼

```lua
matches = {
      {
        -- Matches all sources.
        { "node.name", "matches", "bluez_input.*" },
      },
      {
        -- Matches all sinks.
        { "node.name", "matches", "bluez_output.*" },
      },
    },
```

ä¸Šè¨˜ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ `["bluez5.a2dp.ldac.quality"] = "hq",  -- LDAC HQ ãƒ¢ãƒ¼ãƒ‰` ã¨ã„ã†è¨­å®šã‚’ã—ã¾ã™ï¼ã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¯

- `"bluez_input.*"`: ã™ã¹ã¦ã® Bluetooth å…¥åŠ›ãƒãƒ¼ãƒ‰ï¼ˆãƒã‚¤ã‚¯ãªã©ï¼‰
- `"bluez_output.*"`: ã™ã¹ã¦ã® Bluetooth å‡ºåŠ›ãƒãƒ¼ãƒ‰ï¼ˆãƒ˜ãƒƒãƒ‰ãƒ›ãƒ³ãªã©ï¼‰

æ­£è¦è¡¨ç¾ã§ä¸Šè¨˜ã«ãƒãƒƒãƒã™ã‚‹ã™ã¹ã¦ã®ãƒãƒ¼ãƒ‰ã« `apply_properties` ã‚’é©ç”¨ã™ã‚‹ã¨ã„ã†å†…å®¹ã«ãªã‚Šã¾ã™ï¼å¾“ã£ã¦ï¼Œä»¥ä¸‹ã®ã‚ˆã†ãªè¨­å®šã«ãªã‚Šã¾ã™

```lua
...
  {
    matches = {
      {
        -- Matches all sources.
        { "node.name", "matches", "bluez_input.*" },
      },
      {
        -- Matches all sinks.
        { "node.name", "matches", "bluez_output.*" },
      },
    },
    apply_properties = {
      --["node.nick"] = "My Node",
      --["priority.driver"] = 100,
      --["priority.session"] = 100,
      --["node.pause-on-idle"] = false,
      --["resample.quality"] = 4,
      --["channelmix.normalize"] = false,
      --["channelmix.mix-lfe"] = false,
      --["session.suspend-timeout-seconds"] = 5,  -- 0 disables suspend
      --["monitor.channel-volumes"] = false,

      -- Media source role, "input" or "playback"
      -- Defaults to "playback", playing stream to speakers
      -- Set to "input" to use as an input for apps
      --["bluez5.media-source-role"] = "input",
      ["bluez5.a2dp.ldac.quality"] = "hq",  -- LDAC HQ ãƒ¢ãƒ¼ãƒ‰
    },
  },
...
```

ä¸Šè¨˜å®Ÿè¡Œå¾Œå†ã³ã‚µãƒ¼ãƒ“ã‚¹ã‚’å†èµ·å‹•ã—ã¨ãã¾ã™ï¼

```bash
systemctl --user restart pipewire pipewire-pulse wireplumber
```

ã™ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ãªæ¥ç¶šçŠ¶æ…‹ã«ãªã‚‹ã¯ãšã§ã™

```zsh
% pactl list sinks | grep -A 20 'Name: bluez'                             
	Name: bluez_output.xx_xx_xx_xx_xx_xx.1
	Description: WH-1000XM4
	Driver: PipeWire
	Sample Specification: float32le 2ch 96000Hz
	Channel Map: front-left,front-right
	Owner Module: 4294967295
	Mute: no
	Volume: front-left: 19609 /  30% / -31.44 dB,   front-right: 19609 /  30% / -31.44 dB
	        balance 0.00
	Base Volume: 65536 / 100% / 0.00 dB
	Monitor Source: bluez_output.xx_xx_xx_xx_xx_xx.1.monitor
	Latency: 0 usec, configured 0 usec
	Flags: HARDWARE HW_VOLUME_CTRL DECIBEL_VOLUME LATENCY 
	Properties:
		allowed-rates = "table: 0xxxxxxxxxxxxx"
		api.bluez5.address = "xx:xx:xx:xx:xx:xx"
		api.bluez5.codec = "ldac"
		api.bluez5.profile = "a2dp-sink"
		api.bluez5.transport = ""
		bluez5.a2dp.ldac.quality = "hq"
		card.profile.device = "1"
```

ä»¥ä¸Šã§è¨­å®šã¯å®Œäº†ã§ã™ï¼

::: {.callout-note}
### å‘¨æ³¢æ•°ã¯96kHzã®æ–¹ãŒæœ¬å½“ã«è‰¯ã„ã®ã‹ï¼Ÿ

48kHzã«æ¯”ã¹96kHzã¯è»¢é€å¯èƒ½ãƒ‡ãƒ¼ã‚¿é‡ã¯å€å¢—ã—ã¾ã™ãŒï¼Œãã®åˆ†Bluetooth å¸¯åŸŸã®è² è·ãŒé«˜ããªã‚Šã¾ã™ï¼ãã®ãŸã‚ï¼ŒéŸ³é€”åˆ‡ã‚ŒãŒå‡ºã‚„ã™ããªã‚Šã¾ã™ï¼
å®¶ã‚„éšœå®³ç‰©ã®å°‘ãªã„ç’°å¢ƒãªã‚‰è‰¯ã„ã¨ã¯æ€ã„ã¾ã™ãŒï¼Œå¤–å‡ºã®ã¨ãã«ä½¿ã†å ´åˆã¯96kHzã«ã“ã ã‚ã‚‹å¿…è¦ã¯ãªã„ã¨æ€ã„ã¾ã™ï¼ã¾ãŸï¼Œãã‚‚ãã‚‚è«–ã¨ã—ã¦ã‚ãã¾ã§LDACã¯éŸ³æ¥½ã‚’èããŸã‚ã®codecã§ã‚ã£ã¦ï¼Œé€šè©±ã¨ã‹ã®ã¨ãã¯ä½¿ãˆã¾ã›ã‚“ï¼

:::


### ãã®ä»–ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«ã¤ã„ã¦

[Owner Module]{.mini-section}

`Owner Module`ã¯ï¼ŒéŸ³æºï¼ˆSinkï¼‰ã‚„éŸ³å£°ãƒãƒ¼ãƒ‰ã‚’ æ‰€æœ‰ã—ã¦ã„ã‚‹ PipeWire ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« ã® IDã‚’ã—ã‚ã™ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã§ã™ï¼

```ini
Owner Module: 4294967295
```

ã¨ãªã£ã¦ã¾ã™ãŒ


$$
4,294,967,295 = 2^{32} - 1
$$

ã§ã‚ã‚‹ã“ã¨ã‹ã‚‰ç‰¹åˆ¥ãªæ„å‘³ãŒã‚ã‚Šãã†ãªã“ã¨ãŒæ¨å¯Ÿã§ãã¾ã™ï¼å®Ÿéš›ã«ï¼ŒPipeWire / PulseAudio ã§ã¯ ã€Œæ‰€æœ‰è€…ãªã—ã€ ã‚’è¡¨ã™ãƒ•ãƒ©ã‚°çš„ãªå€¤ã¨ã—ã¦æ‰±ã‚ã‚Œã¦ã¾ã™ï¼

[PulseAudio / PipeWire ã«ãŠã‘ã‚‹éŸ³é‡ã®å†…éƒ¨è¡¨ç¾]{.mini-section}

`Base Volume: 65536 / 100% / 0.00 dB` ã¨ã„ã†è¡ŒãŒã‚ã‚Šã¾ã™ï¼

$$
65,536 = 2^{16}
$$

ã§éŸ³é‡ã®æœ€å¤§å€¤ã‚’ç¤ºã—ã¦ã„ã¾ã™ï¼[PipeWire/pipewire Repository > volume.h source](https://gitlab.freedesktop.org/pipewire/pipewire/-/blob/master/spa/plugins/alsa/acp/volume.h)ã®å®Ÿè£…ã‚’ç¢ºèªã—ã¦ã¿ã‚‹ã¨


```c
typedef uint32_t pa_volume_t;

#define PA_VOLUME_MUTED ((pa_volume_t) 0U)
#define PA_VOLUME_NORM ((pa_volume_t) 0x10000U)
#define PA_VOLUME_MAX ((pa_volume_t) UINT32_MAX/2)
```

ã¨ãªã£ã¦ãŠã‚Šï¼ŒéŸ³é‡ã¯ 32bit unsigned intã¨ã—ã¦æ‰±ã‚ã‚Œã¦ã¾ã™ãŒï¼Œ
```c
#define PA_VOLUME_NORM ((pa_volume_t) 0x10000U)
```

ã§16bit æ­£è¦åŒ– (`0x10000`) ãŒåŸºæº–ã¨ãªã£ã¦ã„ã‚‹ã“ã¨ã‚‚èª­ã¿å–ã‚Œã¾ã™ï¼



## ğŸšï¸ EasyEffectsã®å°å…¥

ãƒ˜ãƒƒãƒ‰ãƒ›ãƒ³ã¯å„è£½å“ã”ã¨ã«å€‹æ€§ãŒå¼·ãï¼ŒåŒã˜éŸ³æºã§ã‚‚èã“ãˆã‹ãŸãŒç•°ãªã‚Šã¾ã™ï¼
å…·ä½“çš„ã«ã¯ï¼Œãƒ˜ãƒƒãƒ‰ãƒ›ãƒ³ã¯ãã®å†ç”Ÿå‘¨æ³¢æ•°ç‰¹æ€§ãŒå„è£½å“ã”ã¨ã«ç•°ãªã‚Šï¼Œãã®ç‰¹æ€§ã«å¿œã˜ã¦ã€Œãƒ‰ãƒ³ã‚·ãƒ£ãƒªå‚¾å‘ã€ã€Œã‹ã¾ã¼ã“å‚¾å‘ã€ã€Œãƒ•ãƒ©ãƒƒãƒˆå‚¾å‘ã€ã®å†ç”ŸéŸ³ã¨ãªã‚Šã¾ã™ï¼

:::: {.no-border-top-table}

| éŸ³å‚¾å‘       | ç‰¹å¾´                                       | å‘ã„ã¦ã„ã‚‹éŸ³æ¥½ã‚¸ãƒ£ãƒ³ãƒ«ãƒ»ç”¨é€”             |
| --------- | ---------------------------------------- | -------------------------- |
| **ãƒ‰ãƒ³ã‚·ãƒ£ãƒª** | ä½éŸ³ã¨é«˜éŸ³ãŒå¼·èª¿ã•ã‚Œã‚‹ï¼ä½éŸ³ãŒã€Œãƒ‰ãƒ³ãƒ‰ãƒ³ã€ï¼Œé«˜éŸ³ãŒã€Œã‚·ãƒ£ãƒªã‚·ãƒ£ãƒªã€ã™ã‚‹æ´¾æ‰‹ãªéŸ³ï¼ | ãƒ­ãƒƒã‚¯ï¼ŒEDM |
| **ã‹ã¾ã¼ã“**  | ä¸­éŸ³åŸŸãŒéš›ç«‹ã¡ï¼Œä½éŸ³ãƒ»é«˜éŸ³ã¯æŠ‘ãˆã‚ï¼ãƒœãƒ¼ã‚«ãƒ«ã‚„ãƒ¡ãƒ­ãƒ‡ã‚£ãŒå‰ã«å‡ºã‚„ã™ã„ï¼      | ã‚¢ã‚³ãƒ¼ã‚¹ãƒ†ã‚£ãƒƒã‚¯ï¼Œãƒœãƒ¼ã‚«ãƒ«é‡è¦–ã®æ¥½æ›²ï¼Œãƒãƒ©ãƒ¼ãƒ‰    |
| **ãƒ•ãƒ©ãƒƒãƒˆ**  | å‘¨æ³¢æ•°ç‰¹æ€§ãŒå‡ä¸€ã«è¿‘ãï¼ŒåŸéŸ³å¿ å®Ÿæ€§ãŒé«˜ã„ï¼éŒ²éŸ³ã‚„ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ç”¨é€”ã«ç†æƒ³çš„ï¼    | ã‚¯ãƒ©ã‚·ãƒƒã‚¯ï¼Œã‚¸ãƒ£ã‚ºï¼ŒéŸ³æºåˆ†æ    |

::::

![source: audio-technica > ãƒ˜ãƒƒãƒ‰ãƒ›ãƒ³ãƒ»ã‚¤ãƒ¤ãƒ›ãƒ³ã‚’è­˜ã‚‹](./frequency.png)

ç„¡ç†ã«èª¿æ•´ã™ã‚‹å¿…è¦ã¯ãªã„ã§ã™ãŒï¼ŒLinuxç’°å¢ƒã§Equalizerèª¿æ•´ã—ãŸã„å ´åˆã¯Pipewireç’°å¢ƒã§ã‚‚å‹•ä½œã™ã‚‹[EasyEffects]{.regmonkey-bold}ãŒãŠã™ã™ã‚ã§ã™ï¼

[Equalizerã¨ã¯ï¼Ÿ]{.mini-section}

ã‚¤ã‚³ãƒ©ã‚¤ã‚¶ãƒ¼ã¯éŸ³è³ªå‚¾å‘ã‚’ãƒªã‚±ãƒ¼ãƒ–ãƒ«ã®ã‚ˆã†ã«ç‰©ç†çš„ã«ã§ã¯ãªãï¼Œã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã§é–“æ¥çš„ã«éŸ³è³ªã‚’å¤‰ãˆã‚‹æ‰‹æ³•ã§ã™ï¼

- éŸ³æ¥½ãƒªã‚¹ãƒ‹ãƒ³ã‚°ã§å¥½ã¿ã®éŸ³è³ªã«èª¿æ•´
- ãƒ˜ãƒƒãƒ‰ãƒ›ãƒ³ã§ãƒãƒ¼ãƒãƒ£ãƒ«ã‚µãƒ©ã‚¦ãƒ³ãƒ‰åŒ–

ã¨ã„ã†ç›®çš„ã®ãŸã‚ã«è«’ã•ã‚Œã¾ã™ï¼Equalizer ã‚’ä½¿ã†ã¨ï¼Œå„å‘¨æ³¢æ•°å¸¯ï¼ˆä½éŸ³é ˜åŸŸãƒ»ä¸­éŸ³é ˜åŸŸãƒ»é«˜æ¸©é ˜åŸŸï¼‰ã®éŸ³é‡ã‚’å€‹åˆ¥ã«å¢—æ¸›ã§ãã¾ã™ï¼


![Equalizer by EasyEffects](./easyeffects.png)

[Easy Effectsã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«]{.mini-section}

apt packageã§å…¥ã‚Œã‚‹å ´åˆã¯ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™

```zsh
# apt package
sudo apt install easyeffects
```

[Equalizerè¨­å®š]{.mini-section}

åŸºæœ¬çš„ã«ã¯è‡ªåˆ†ãŒç†æƒ³ã¨ã™ã‚‹éŸ³è³ªã«åˆã‚ã›ã¦å‘¨æ³¢æ•°ã”ã¨ã®ã‚²ã‚¤ãƒ³ã‚’èª¿æ•´ã—ã¾ã™ï¼
è‡ªåˆ†ã¯[AutoEQ](https://autoeq.app/)ã®å‘¨æ³¢æ•°è£œæ­£ãƒ—ãƒªã‚»ãƒƒãƒˆã‚’ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ã¨ã—ã¦å°‘ã—è‡ªåˆ†å¥½ã¿ã«å¤‰æ›´ã—ã¾ã—ãŸï¼

select headphonesã®ã¨ã“ã‚ã«ï¼Œ`Sony WH-1000XM4 (ANC Off)`ã‚’å…¥åŠ›ã™ã‚‹ã¨ä»¥ä¸‹ã®ã‚ˆã†ãªã‚°ãƒ©ãƒ•ãŒã§ã¦ãã¾ã™

![AutoEq](./autoeq.png)

:::: {.no-border-top-table}

| ç”¨èª        | èª¬æ˜                                   |
| --------- | ------------------------------------ |
| RAW       | å…ƒã®ãƒ˜ãƒƒãƒ‰ãƒ›ãƒ³ãƒ»ã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼ã®å‘¨æ³¢æ•°ç‰¹æ€§ï¼ˆè£œæ­£å‰ï¼‰             |
| TARGET    | ç†æƒ³ã®å‘¨æ³¢æ•°ç‰¹æ€§ï¼ˆç›®æ¨™ã‚«ãƒ¼ãƒ–ï¼‰                      |
| EQUALIZED | EQ è£œæ­£ã‚’é©ç”¨ã—ãŸå¾Œã®ç‰¹æ€§ï¼ˆRAW â†’ TARGET ã«è¿‘ã¥ã‘ãŸçŠ¶æ…‹ï¼‰ |

::::

31-band Graphic Eqã‚’ã‚³ãƒ”ãƒšã—ã¦ï¼Œã¡ã‚‡ã£ã¨è‡ªåˆ†å¥½ã¿ã«ç·¨é›†ã—ã¾ã™ï¼ãã®å¾Œä»¥ä¸‹ã®å½¢å¼ã§txtãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜ã—ã¾ã™ï¼

```txt
Preamp: 0db
Filter 1: ON PK Fc 20 Hz Gain 0 dB Q 4.36
Filter 2: ON PK Fc 25 Hz Gain 0 dB Q 4.36
Filter 3: ON PK Fc 32 Hz Gain 0 dB Q 4.36
Filter 4: ON PK Fc 40 Hz Gain 0 dB Q 4.36
Filter 5: ON PK Fc 50 Hz Gain 0 dB Q 4.36
Filter 6: ON PK Fc 63 Hz Gain 0 dB Q 4.36
Filter 7: ON PK Fc 80 Hz Gain -0.2 dB Q 4.36
Filter 8: ON PK Fc 101 Hz Gain 1.1 dB Q 4.36
Filter 9: ON PK Fc 127 Hz Gain 0 dB Q 4.36
Filter 10: ON PK Fc 160 Hz Gain 0 dB Q 4.36
Filter 11: ON PK Fc 202 Hz Gain 0 dB Q 4.36
Filter 12: ON PK Fc 254 Hz Gain -0.9 dB Q 4.36
Filter 13: ON PK Fc 320 Hz Gain 0.7 dB Q 4.36
Filter 14: ON PK Fc 403 Hz Gain 2.2 dB Q 4.36
Filter 15: ON PK Fc 508 Hz Gain 0.3 dB Q 4.36
Filter 16: ON PK Fc 640 Hz Gain 3 dB Q 4.36
Filter 17: ON PK Fc 806 Hz Gain 2.3 dB Q 4.36
Filter 18: ON PK Fc 1016 Hz Gain 0.8 dB Q 4.36
Filter 19: ON PK Fc 1280 Hz Gain 1 dB Q 4.36
Filter 20: ON PK Fc 1613 Hz Gain -1.1 dB Q 4.36
Filter 21: ON PK Fc 2032 Hz Gain 0.5 dB Q 4.36
Filter 22: ON PK Fc 2560 Hz Gain -1.1 dB Q 4.36
Filter 23: ON PK Fc 3225 Hz Gain -0.7 dB Q 4.36
Filter 24: ON PK Fc 4064 Hz Gain 2.2 dB Q 4.36
Filter 25: ON PK Fc 5120 Hz Gain 1.7 dB Q 4.36
Filter 26: ON PK Fc 6451 Hz Gain 0.2 dB Q 4.36
Filter 27: ON PK Fc 8127 Hz Gain -3 dB Q 4.36
Filter 28: ON PK Fc 10240 Hz Gain -0.4 dB Q 4.36
Filter 29: ON PK Fc 12902 Hz Gain 2 dB Q 4.36
Filter 30: ON PK Fc 16255 Hz Gain 4.7 dB Q 4.36
Filter 31: ON PK Fc 20480 Hz Gain 10.7 dB Q 4.36

```

ãã‚Œã‚’Import Presetã®APOã‹ã‚‰èª­ã¿è¾¼ã¾ã›ã‚Œã°å®Œäº†ã§ã™ï¼æ°—ã«å…¥ã‚‰ãªã‘ã‚Œã°toggleã§on/offã§ãã‚‹ã®ã‚‚EasyEffectsã®è‰¯ã„ã¨ã“ã‚ã§ã™ï¼

[åˆ©ç”¨ã—ã¦ã‚‹ã¨ãã«ãƒˆãƒ©ãƒ–ãƒ«ãŒç™ºç”Ÿã—ãŸå ´åˆ]{.mini-section}

EasyEffectsã‚’åˆ©ç”¨ã—ã¦ã„ã‚‹ã¨ãï¼ŒãŸã¾ã«éŸ³å£°å‡ºåŠ›ã‚„EQå‡¦ç†ã§ãƒ•ãƒªãƒ¼ã‚ºã—ãŸã‚Šã—ã¾ã™ï¼
è‡ªåˆ†ãŒç›´é¢ã—ãŸã‚±ãƒ¼ã‚¹ã ã¨PipeWire ã‚„ Bluetooth æ¥ç¶šè‡ªä½“ã®å•é¡Œã§ã¯ãªãï¼ŒEasyEffects ã® GUI ã‚„ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒåŸå› ã ã£ãŸã®ã§ï¼Œ
å®Ÿè¡Œä¸­ã® EasyEffects ãƒ—ãƒ­ã‚»ã‚¹ã‚’å¼·åˆ¶çµ‚äº†ã™ã‚‹å½¢ã§å¯¾å‡¦ã—ã¦ã„ã¾ã™ï¼ã‚³ãƒãƒ³ãƒ‰ã¯ä»¥ä¸‹

```bash
killall easyeffects
```

## Appendix 1: Bluetooth

::: {#def- .custom_problem .blog-custom-border}
[Bluetooth]{.def-title}

- 2.54GHzå¸¯ã®é›»æ³¢ã‚’ä½¿ã£ã¦é€šä¿¡ã™ã‚‹ç„¡ç·šé€šä¿¡è¦æ ¼
- èµ¤å¤–ç·š(IrDA)ã¨ç•°ãªã‚Šï¼Œã‚¤ãƒ³ãƒ•ã‚¡ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹éƒ¨åˆ†ã‚’å¤§å‹åˆ©ãã«å‘ã‘ã‚‹å¿…è¦ã¯ãªã„
- Wi-Fiã®ã‚ˆã†ã«é«˜é€Ÿé€šä¿¡ã§ã¯ãªã„ãŒï¼Œæ¶ˆè²»é›»åŠ›ãŒå°‘ãªãå°å‹ã®æ©Ÿå™¨ã«å‘ã„ã¦ã„ã‚‹

:::

Bluetoothè£½å“ã®è¦æ ¼ã§é‡è¦ãªã®ãŒã€ŒVersionã€ã€ŒClassã€ã€ŒProfileã€ã®ä¸‰ç‚¹ï¼

:::: {.no-border-top-table}

| é …ç›® | èª¬æ˜ |
|-----|------|
|Version| é€šä¿¡æ–¹å¼ã‚„é€šä¿¡é€Ÿåº¦ã‚’è¦å®šã—ãŸã‚‚ã®|
|Class|é›»æ³¢å¼·åº¦ã¨æœ€å¤§é€šä¿¡è·é›¢ã‚’è¡¨ã™| 
|Profile|Bluetoothã§ã‚„ã‚Šå–ã‚Šã™ã‚‹ãŸã‚ã«é€šä¿¡ãƒ«ãƒ¼ãƒ«ï¼éŸ³å£°ã‚¹ãƒ†ãƒ¬ã‚ªé€šä¿¡ãªã‚‰ã°ã€ŒA2DPã€ï¼Œãƒã‚¦ã‚¹ã‚„ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ãªã©ã®å…¥åŠ›è£…ç½®ãªã‚‰ã°ã€ŒHIDã€|
: {tbl-colwidths="[25,75]"}

::::

::: {#def- .custom_problem .blog-custom-border}
[Bluetooth Class]{.def-title}

- Bluetoothã®ã‚¯ãƒ©ã‚¹ã¨ã¯ï¼Œé›»æ³¢ã®æœ€å¤§å‡ºåŠ›ã‚„åˆ°é”è·é›¢ã‚’è¦å®šã—ãŸåç§°
- æœ€å¤§é€šä¿¡è·é›¢ã«ã‚ˆã£ã¦ã€Œã‚¯ãƒ©ã‚¹1ã€ï¼Œã€Œã‚¯ãƒ©ã‚¹2ã€ï¼Œã€Œã‚¯ãƒ©ã‚¹3ã€ã®3ã¤ã®ç¨®é¡ã«åˆ†ã‘ã‚‰ã‚Œã¦ã„ã¾ã™ï¼

:::

:::: {.no-border-top-table}
|ã‚¯ãƒ©ã‚¹ã®ç¨®é¡ |	æœ€å¤§å‡ºåŠ› | é€šä¿¡æœ€å¤§è·é›¢|
|-----------|--------|------------|
|ã‚¯ãƒ©ã‚¹1     | 100mW  | ç´„100m      |
|ã‚¯ãƒ©ã‚¹2     | 2.5mW  | ç´„10m       |
|ã‚¯ãƒ©ã‚¹3     | 1mW    | ç´„1m        |
::::

ãªãŠæ—¥æœ¬å›½å†…ã§ã¯ã€Œã‚¯ãƒ©ã‚¹1ã€ã¨ã„ãˆã©10mWãŒé™ç•Œã®ãŸã‚æœ€å¤§å€¤ã®1/10ãŒæœ€å¤§å‡ºåŠ›ã§ã™ï¼


## Appendix 2: Bluetoothãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

[PipeWireéŸ³å£°ã‚µãƒ¼ãƒã®å†èµ·å‹•]{.mini-section}

```bash
systemctl --user restart pipewire pipewire-pulse
```

- ã€Œæ¥ç¶šæ¸ˆã¿ãªã®ã«éŸ³ãŒå‡ºãªã„ã€ï¼Œã€ŒSink ãŒèªè­˜ã•ã‚Œãªã„ã€ãªã©ã®ãƒˆãƒ©ãƒ–ãƒ«ãŒç™ºç”Ÿã—ãŸã‚‰ã¾ãšã“ã‚Œ

[Blueetooth deviceã®å†æ¥ç¶š]{.mini-section}

Blueetooth deviceæ¥ç¶šè¨­å®šã‚’ä»¥ä¸‹ã®æ‰‹é †ã§å®Œå…¨ãƒªã‚»ãƒƒãƒˆ

1. Disconnect
2. Removeï¼ˆãƒšã‚¢ãƒªãƒ³ã‚°æƒ…å ±ã‚¯ãƒªã‚¢ï¼‰
3. Pairï¼ˆå†ãƒšã‚¢ãƒªãƒ³ã‚°ï¼‰
4. Trust & Connectï¼ˆè‡ªå‹•ä¿¡é ¼ãƒ»å†æ¥ç¶šï¼‰


ã“ã“ã§ã„ã† `Trust` ã¯æŒ‡å®šã—ãŸãƒ‡ãƒã‚¤ã‚¹ã‚’ ä¿¡é ¼æ¸ˆã¿ï¼ˆTrustedï¼‰ ã¨ãƒãƒ¼ã‚¯ã™ã‚‹ã“ã¨ã§ï¼Œä¿¡é ¼æ¸ˆã¿ãƒ‡ãƒã‚¤ã‚¹ã¯è‡ªå‹•æ¥ç¶šå¯èƒ½ï¼ä¸€æ–¹ï¼Œ
ä¿¡é ¼ã—ã¦ã„ãªã„å ´åˆã¯ï¼Œæ¯å›ãƒ¦ãƒ¼ã‚¶ãƒ¼æ‰¿èªãŒå¿…è¦ã«ãªã‚Šã¾ã™ï¼


```bash
#!/bin/bash
# -----------------------------------------------------------------------------
# Author: Ryo Nakagami
# Revised: 2025-12-28
# Script: bt_repair.sh
# Description:
#   Bluetooth device re-pairing script for troubleshooting connection issues.
#   Completely removes and re-establishes the pairing with a Bluetooth device.
#
#   Steps:
#     1. Disconnect the specified Bluetooth device
#     2. Remove the device (clear pairing information)
#     3. Re-pair with the device
#     4. Trust and reconnect to the device
#
# Arguments:
#   <MAC_ADDRESS>   Bluetooth device MAC address (e.g., 00:02:3C:8B:88:90)
#
# Usage:
#   ./bt_repair.sh <MAC_ADDRESS>        # Re-pair with specified device
#   ./bt_repair.sh 00:02:3C:8B:88:90    # Example with actual MAC address
#   ./bt_repair.sh                      # Show usage and available devices
#
# Notes:
#   - Requires bluetoothctl (part of bluez package) installed.
#   - Device must be in pairing mode before running this script.
#   - AutoEnable=true in /etc/bluetooth/main.conf is recommended.
# -----------------------------------------------------------------------------

# å¼•æ•°ãƒã‚§ãƒƒã‚¯
if [ -z "$1" ]; then
    echo "Usage: $0 <MAC_ADDRESS>"
    echo "Example: $0 00:02:3C:8B:88:90"
    echo ""
    echo "Available devices:"
    bluetoothctl devices
    exit 1
fi

DEVICE_MAC="$1"

echo "=== Bluetooth Re-pairing ==="
echo "MAC Address: ${DEVICE_MAC}"
echo ""

# 1. æ¥ç¶šè§£é™¤
echo "[1/4] Disconnecting..."
bluetoothctl disconnect "${DEVICE_MAC}" 2>/dev/null
sleep 1

# 2. ãƒ‡ãƒã‚¤ã‚¹å‰Šé™¤ï¼ˆãƒšã‚¢ãƒªãƒ³ã‚°æƒ…å ±ã‚’ã‚¯ãƒªã‚¢ï¼‰
echo "[2/4] Removing device..."
bluetoothctl remove "${DEVICE_MAC}" 2>/dev/null
sleep 2

# 3. å†ãƒšã‚¢ãƒªãƒ³ã‚°
echo "[3/4] Pairing..."
echo "â€» ãƒ‡ãƒã‚¤ã‚¹ãŒãƒšã‚¢ãƒªãƒ³ã‚°ãƒ¢ãƒ¼ãƒ‰ã«ãªã£ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„"
bluetoothctl pair "${DEVICE_MAC}"
sleep 2

# 4. æ¥ç¶š
echo "[4/4] Connecting..."
bluetoothctl trust "${DEVICE_MAC}"
bluetoothctl connect "${DEVICE_MAC}"

echo ""
echo "=== Complete ==="
```


## Appendix 3: `0x10000U` ã®prefixã¨suffix

`0x10000U` ã«ã¯ `0x` ã¨ã„ã†prefixã¨ `U` ã¨ã„ã†suffixãŒä»˜ã„ã¦ã¾ã™ï¼

- `0x`: ç¶šãdigitsãŒ16é€²æ•°(hexadecimal number)ã§ã‚ã‚‹ã“ã¨ã‚’è¡¨ã™
- `U`: `unsigned`ã‚’è¡¨ã™ï¼ã¤ã¾ã‚Šä»Šå›ã¯ unsigned integer

å¾“ã£ã¦ï¼Œ`0x10000U` ã¯

$$
65,536 = 1 \times 16^4 + 0 \times 16^3 + 0 \times 16^2 + 0 \times 16^1  + 0 \times 16^0
$$

ã¨ãªã‚Šã¾ã™ï¼


[C, C++ã§ä½¿ç”¨ã•ã‚Œã‚‹suffixä¾‹]{.mini-section}

:::: {.no-border-top-table}

| value    | suffix | meaning                                    |
| -------- | ------ | ------------------------------------- |
| `123`    |        | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®æ•´æ•°å‹ï¼ˆé€šå¸¸ `int`ï¼‰                   |
| `123u`   | `u`    | `unsigned int`ï¼ˆç¬¦å·ãªã—æ•´æ•°ï¼‰                |
| `123l`   | `l`    | `long`ï¼ˆç¬¦å·ä»˜ãé•·æ•´æ•°ï¼Œç’°å¢ƒä¾å­˜ã§32bitï¼‰         |
| `123L`   | `L`    | `long`ï¼ˆç¬¦å·ä»˜ãé•·æ•´æ•°ï¼‰                       |
| `123uL`  | `uL`   | `unsigned long`ï¼ˆç¬¦å·ãªã—é•·æ•´æ•°ï¼‰              |
| `123LL`  | `LL`   | `long long`ï¼ˆç¬¦å·ä»˜ã64bitæ•´æ•°ï¼‰          |
| `123uLL` | `uLL`  | `unsigned long long`ï¼ˆç¬¦å·ãªã—64bitæ•´æ•°ï¼‰ |

::::

```{zsh}
% gcc check_numeric_type.c -o test && ./test
Type                 Bytes  Min                    Max                   
int                  4      -2147483648            2147483647            
short                2      -32768                 32767                 
long                 8      -9223372036854775808   9223372036854775807   
unsigned short       2      0                      65535                 
unsigned long        8      0                      18446744073709551615  
long long            8      -9223372036854775808   9223372036854775807   
unsigned long long   8      0                      18446744073709551615  
float                4      -3.402823e+38          3.402823e+38          
double               8      -1.797693e+308         1.797693e+308         
long double          16     -1.189731e+4932        1.189731e+4932 
```

ã¤ã¾ã‚Šï¼Œ`long long` ã¯ 8 bytes(=64 bits)ã§ã‚ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ï¼


References
----------
- [AutoEQ](https://autoeq.app/)
- [audio-technica > ãƒ˜ãƒƒãƒ‰ãƒ›ãƒ³ãƒ»ã‚¤ãƒ¤ãƒ›ãƒ³ã‚’è­˜ã‚‹](https://www.audio-technica.co.jp/headphone/navi/whatis/06.php)
- [WirePlumber setting](https://pipewire.pages.freedesktop.org/wireplumber/daemon/configuration/bluetooth.html)
- [PipeWire/pipewire Repository > volume.h source](https://gitlab.freedesktop.org/pipewire/pipewire/-/blob/master/spa/plugins/alsa/acp/volume.h)
- [Ryo's Tech Blog > Sony WF-1000XM3 Bluetoothã®è¨­å®š](https://ryonakagami.github.io/2021/04/23/ubuntu-sony-bluetooth-setting/)
