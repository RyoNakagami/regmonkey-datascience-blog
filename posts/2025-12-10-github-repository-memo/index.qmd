---
title: "è‡ªåˆ†ç”¨GitHub Repositoryä½œæˆæ™‚ã®ãƒ¡ãƒ¢"
author: "Ryo Nakagami"
date: "2025-12-10"
date-modified: "2025-12-11"
categories: [ç’°å¢ƒæ§‹ç¯‰, github]
listing_category: development
comments:
  utterances:
       repo: RyoNakagami/regmonkey-datascience-blog
       label: discussion
       issue-term: title
---

## ğŸ”¨ Getting Started

::: {.callout-note}

- ã‚ãã¾ã§å…±é€šé …ã«ã¤ã„ã¦ã®ãƒ¡ãƒ¢ã§ã™
- å³å¯†ã«ã¯ä¸‹è¨˜ã®Step 3 ghã‚³ãƒãƒ³ãƒ‰ã®å®Ÿè¡Œ ã®å‰ã«document ã‚„ gitignoreãªã‚Šä»–ã«ã‚‚ã‚„ã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã™

:::

[minimum structure]{.mini-section}

```ini
.
â”œâ”€â”€ .github/
â”‚   â”œâ”€â”€ repository_metadata/    # Repository configuration files
â”‚   â”‚   â”œâ”€â”€ gh_repo.yml        # Repository metadata
â”‚   â”‚   â””â”€â”€ label_master.yml   # Label definitions
â”‚   â””â”€â”€ workflows/             # GitHub Actions workflows
â”‚       â””â”€â”€ label-generator.yml # Label automation workflow
â””â”€â”€ README.md
```

[æ‰‹é †]{.mini-section}

1. **ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ä½œæˆã¨ç§»å‹•**

    ```bash
    mkdir <repository-name> && cd $_
    ```

2. **Repositoryãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã®ä½œæˆ**

    ä»¥ä¸‹ã®ã‚ˆã†ã« `.github/repository_metadata/gh_repo.yml` ã«è¨˜è¿°ã—ã¾ã™

    ```{.yaml filename='gh_repo.yml'}
    meta-data:
    repository_name: your-repo-name       # Required: Repository name
    visibility: private|public            # Required: Repository visibility
    org-name: YourOrgName                # Required: Organization name
    homepage: YourURL                    # Optional: e.g., https://ryonakagami.github.io/regmonkey-datascience-blog/
    tag:                                 # Optional: Repository tags
      - tag1
      - tag2
    description: |                       # Required: Repository description
      A clear, concise description of your project.
    ```

::: {.callout-caution style="margin-left: 2em;"}

`'Required'` ã¨ã•ã‚Œã¦ã„ã‚‹ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯å¿…ãšå…¥åŠ›ã—ã¦ä¸‹ã•ã„

:::

3. **ghã‚³ãƒãƒ³ãƒ‰ã®å®Ÿè¡Œ**

    è‡ªåˆ†ã¯ `.gitconfig` ã§ Alias è¨­å®šã‚’è¡Œã„ [git create-repo](https://github.com/RyoNakagami/regmonkey-gitcommand/blob/main/src/git-create-repo.sh) ã¨ 
    [git update-repo](https://github.com/RyoNakagami/regmonkey-gitcommand/blob/main/src/git-repo-update.sh) ã‚’å®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ï¼

    ```bash
    # step 1
    git create-repo   # only when the repository not created yet

    # step 2
    git update-repo   # reflecting tags, description, and homepage
    ```

4. **ï¼ˆOptionalï¼‰ãƒ©ãƒ™ãƒ«ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º**

    `.github/repository_metadata/label_master.yml` ã‚’ä»¥ä¸‹ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã§ç·¨é›†ï¼`main` ã¸ã®pushãŒ `label_master.yml` ã®å¤‰æ›´ã‚’å«ã‚“ã§ã„ã‚‹ã¨ãã«ãƒ©ãƒ™ãƒ«ãŒä½œæˆã•ã‚Œã‚‹

    ```yml
    # ------------------------------------------------
    # GitHub Issue Labels aligned with Branch Naming Conventions
    # Author: Ryo Nakagami
    # ------------------------------------------------
    
    # --- Development Workflows (Aligned with Branch Prefixes) ---
    - name: environment
      color: EFDECD         # almond
      description: This issue is related to development repository structure etc
    
    - name: feature
      color: 008000         # green
      description: New feature development
    
    - name: bugfix
      color: DC143C         # crimson
      description: Bug fix or defect correction
    ```


### Label Generator Workflow

:::: {.no-border-top-table}

| ã‚¤ãƒ™ãƒ³ãƒˆ              | Workflow ãŒå‹•ä½œã™ã‚‹ï¼Ÿ| èª¬æ˜                               |
| -------------------- | --------------- | -------------------------- |
| `main` ã¸ã® PR ã‚’ä½œæˆ         | âŒ                                            | `push` ã§ã¯ãªã„ãŸã‚                      |
| `main` ã¸ã® PR ã‚’æ›´æ–°ï¼ˆã‚³ãƒŸãƒƒãƒˆè¿½åŠ ï¼‰ | âŒ | push ã¯ç™ºç”Ÿã—ã¦ã„ã‚‹ãŒï¼Œãã®ãƒ–ãƒ©ãƒ³ãƒã§å‹•ãã®ã§ `main` ã¨ã¯é–¢ä¿‚ãªã—                                 |
| `main` ã¸ã® PR ã‚’ merge     | âœ…                                            | merge commit ãŒ `main` ã« `push` ã•ã‚Œã‚‹ãŸã‚ |

::::


[ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«]{.mini-section}

```{.yaml filename='label-generator.yml'}
name: Label Manager

# Trigger: Runs when labels.yaml is modified
on:
  push:
    branches:
      - main
    paths:
      - .github/repository_metadata/label_master.yml

# Minimal required permissions
permissions:
  contents: read    # Read repository files
  issues: write     # Create/update/delete labels

jobs:
  sync-labels:
    runs-on: ubuntu-latest
    
    steps:
      # ============================================================
      # SETUP: Install required tools and authenticate
      # ============================================================
      
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Install uv
        uses: astral-sh/setup-uv@v4
        # uv is used to install Python tools like yamlcli

      - name: Install dependencies
        run: |
          # Update package lists quietly
          sudo apt-get update -qq
          
          # Install jq (JSON processor) and gh (GitHub CLI)
          sudo apt-get install -y -qq jq gh
          
          # Install yamlcli via uv to convert YAML to JSON
          uv tool install git+https://github.com/RyoNakagami/yamlcli.git

      - name: Authenticate GitHub CLI
        run: echo "${{ secrets.GITHUB_TOKEN }}" | gh auth login --with-token
        # Note: Not setting GH_TOKEN here allows gh to store credentials
        # This prevents "To have GitHub CLI store credentials..." warning

      # ============================================================
      # PARSE: Convert YAML configuration to JSON
      # ============================================================
      
      - name: Parse labels configuration
        id: parse
        run: |
          # Convert labels.yaml to JSON format and save to file
          yamlcli --to-json .github/repository_metadata/label_master.yml > /tmp/labels.json
          echo "Labels configuration parsed successfully"

      # ============================================================
      # SYNC: Create or update labels from configuration
      # ============================================================
      
      - name: Sync labels
        run: |
          # Exit on error, undefined variables, or pipe failures
          set -euo pipefail
          
          # Get list of existing label names once to avoid repeated API calls
          EXISTING_LABELS=$(gh label list --json name --jq '.[].name')
          
          # Process each label definition from the JSON array
          jq -c '.[]' /tmp/labels.json | while IFS= read -r label; do
            # Extract label properties
            NAME=$(echo "$label" | jq -r '.name')
            COLOR=$(echo "$label" | jq -r '.color')
            DESC=$(echo "$label" | jq -r '.description // ""')  # Default to empty string if null
            
            echo "Processing label: $NAME"
            
            # Check if label already exists in repository
            if echo "$EXISTING_LABELS" | grep -Fxq "$NAME"; then
              # Update existing label
              echo "  Updating existing label"
              gh label edit "$NAME" --color "$COLOR" --description "$DESC"
            else
              # Create new label
              echo "  Creating new label"
              gh label create "$NAME" --color "$COLOR" --description "$DESC"
            fi
          done

      # ============================================================
      # PRUNE: Remove labels not defined in configuration
      # ============================================================
      
      - name: Prune obsolete labels
        run: |
          # Exit on error, undefined variables, or pipe failures
          set -euo pipefail
          
          # Get list of all existing labels in the repository
          EXISTING_LABELS=$(gh label list --json name --jq '.[].name')
          
          # Get list of desired labels from configuration
          DESIRED_LABELS=$(jq -r '.[].name' /tmp/labels.json)
          
          # Check each existing label
          echo "$EXISTING_LABELS" | while IFS= read -r label; do
            # Skip empty lines
            if [[ -n "$label" ]] && ! echo "$DESIRED_LABELS" | grep -Fxq "$label"; then
              # Label exists in repo but not in config - delete it
              echo "Deleting obsolete label: $label"
              gh label delete "$label" --yes || echo "  Failed to delete $label (may be in use)"
            fi
          done
        # gh CLI uses stored credentials from auth login step
```



References
----------
- [regmonkey-gitcommand](https://github.com/RyoNakagami/regmonkey-gitcommand)
